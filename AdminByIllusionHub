--[[
    üí≤ ULTIMATE ADMIN PANEL - 100% WORKING FIX
    Safe Mode (PlayerGui) | Double Click | Timer | Notifications
]]

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Debris = game:GetService("Debris")

local player = Players.LocalPlayer
local camera = Workspace.CurrentCamera

-- 1. RIMOZIONE VECCHIE GUI (Reset Totale)
local PlayerGui = player:WaitForChild("PlayerGui")
for _, gui in pairs(PlayerGui:GetChildren()) do
    if gui.Name == "UltimateAdminPanel" then gui:Destroy() end
end

-- VARIABILI
local selectedPlayer = nil
local PanelOpen = false
local cooldowns = {}
local lastClickTimes = {}

-- 2. CREAZIONE INTERFACCIA (GUI)
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "UltimateAdminPanel"
ScreenGui.ResetOnSpawn = false -- Non sparisce se muori
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.IgnoreGuiInset = true
ScreenGui.Parent = PlayerGui -- Sicuro al 100%

-- NOTIFICHE (Basso Destra)
local NotifContainer = Instance.new("Frame")
NotifContainer.Size = UDim2.new(0, 250, 1, 0)
NotifContainer.Position = UDim2.new(1, -260, 0, -20)
NotifContainer.AnchorPoint = Vector2.new(0, 0)
NotifContainer.BackgroundTransparency = 1
NotifContainer.Parent = ScreenGui

local NotifList = Instance.new("UIListLayout")
NotifList.VerticalAlignment = Enum.VerticalAlignment.Bottom
NotifList.HorizontalAlignment = Enum.HorizontalAlignment.Right
NotifList.Padding = UDim.new(0, 5)
NotifList.Parent = NotifContainer

-- TASTO TOGGLE (üí≤) - Vicino Chat
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Name = "Toggle"
ToggleBtn.Size = UDim2.new(0, 45, 0, 45)
ToggleBtn.Position = UDim2.new(0, 100, 0, 10) -- X: 100 (Vicino chat), Y: 10
ToggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
ToggleBtn.BorderSizePixel = 0
ToggleBtn.Text = "üí≤"
ToggleBtn.TextSize = 25
ToggleBtn.TextColor3 = Color3.fromRGB(0, 255, 100)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.Parent = ScreenGui

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 12)
ToggleCorner.Parent = ToggleBtn

local ToggleStroke = Instance.new("UIStroke")
ToggleStroke.Color = Color3.fromRGB(0, 255, 100)
ToggleStroke.Thickness = 2
ToggleStroke.Parent = ToggleBtn

-- MAIN FRAME
local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 650, 0, 400)
MainFrame.Position = UDim2.new(0.5, -325, 0.5, -200)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Visible = false
MainFrame.ClipsDescendants = true
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 15)
MainCorner.Parent = MainFrame

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(80, 80, 80)
MainStroke.Thickness = 2
MainStroke.Parent = MainFrame

-- HEADER
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 50)
Header.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
Header.BorderSizePixel = 0
Header.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Text = "ADMIN PANEL"
Title.Size = UDim2.new(1, -50, 1, 0)
Title.Position = UDim2.new(0, 20, 0, 0)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 22
Title.Font = Enum.Font.GothamBlack
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

local CloseBtn = Instance.new("TextButton")
CloseBtn.Text = "X"
CloseBtn.Size = UDim2.new(0, 50, 1, 0)
CloseBtn.Position = UDim2.new(1, -50, 0, 0)
CloseBtn.BackgroundTransparency = 1
CloseBtn.TextColor3 = Color3.fromRGB(255, 80, 80)
CloseBtn.TextSize = 20
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Parent = Header

-- SCROLL LISTS
local PlayerScroll = Instance.new("ScrollingFrame")
PlayerScroll.Size = UDim2.new(0.35, 0, 1, -60)
PlayerScroll.Position = UDim2.new(0.63, 0, 0, 55)
PlayerScroll.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
PlayerScroll.BorderSizePixel = 0
PlayerScroll.ScrollBarThickness = 4
PlayerScroll.Parent = MainFrame
local PCorner = Instance.new("UICorner"); PCorner.CornerRadius = UDim.new(0, 10); PCorner.Parent = PlayerScroll
local PList = Instance.new("UIListLayout"); PList.Padding = UDim.new(0,5); PList.SortOrder = Enum.SortOrder.LayoutOrder; PList.Parent = PlayerScroll

local CmdScroll = Instance.new("ScrollingFrame")
CmdScroll.Size = UDim2.new(0.60, 0, 1, -60)
CmdScroll.Position = UDim2.new(0, 10, 0, 55)
CmdScroll.BackgroundTransparency = 1
CmdScroll.BorderSizePixel = 0
CmdScroll.ScrollBarThickness = 2
CmdScroll.Parent = MainFrame
local Grid = Instance.new("UIGridLayout"); Grid.CellSize = UDim2.new(0.48, 0, 0, 55); Grid.CellPadding = UDim2.new(0.04, 0, 0, 10); Grid.Parent = CmdScroll

-- 3. FUNZIONE NOTIFICA (Barra Verde Scorrevole)
local function Notify(cmd, target)
    local f = Instance.new("Frame")
    f.Size = UDim2.new(1, 0, 0, 60)
    f.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    f.Parent = NotifContainer
    
    local fc = Instance.new("UICorner"); fc.CornerRadius = UDim.new(0, 8); fc.Parent = f
    local fs = Instance.new("UIStroke"); fs.Color = Color3.fromRGB(80,80,80); fs.Parent = f
    
    local t = Instance.new("TextLabel")
    t.Text = "EXECUTED: " .. cmd
    t.Size = UDim2.new(1, -10, 0, 20)
    t.Position = UDim2.new(0, 10, 0, 5)
    t.BackgroundTransparency = 1
    t.TextColor3 = Color3.fromRGB(0, 255, 100)
    t.Font = Enum.Font.GothamBold
    t.TextSize = 14
    t.TextXAlignment = Enum.TextXAlignment.Left
    t.Parent = f
    
    local d = Instance.new("TextLabel")
    d.Text = "Target: " .. target
    d.Size = UDim2.new(1, -10, 0, 20)
    d.Position = UDim2.new(0, 10, 0, 25)
    d.BackgroundTransparency = 1
    d.TextColor3 = Color3.fromRGB(200, 200, 200)
    d.Font = Enum.Font.Gotham
    d.TextSize = 12
    d.TextXAlignment = Enum.TextXAlignment.Left
    d.Parent = f
    
    local bar = Instance.new("Frame")
    bar.BackgroundColor3 = Color3.fromRGB(0, 255, 100)
    bar.BorderSizePixel = 0
    bar.Size = UDim2.new(1, 0, 0, 3)
    bar.Position = UDim2.new(0, 0, 1, -3)
    bar.Parent = f
    
    TweenService:Create(bar, TweenInfo.new(3), {Size = UDim2.new(0,0,0,3)}):Play()
    
    task.delay(3, function()
        f:Destroy()
    end)
end

-- 4. CREAZIONE BOTTONI (Logica Doppio Click + Timer)
local function CreateBtn(name, icon, func)
    local b = Instance.new("TextButton")
    b.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    b.Text = ""
    b.Parent = CmdScroll
    local bc = Instance.new("UICorner"); bc.CornerRadius = UDim.new(0, 10); bc.Parent = b
    
    local i = Instance.new("TextLabel")
    i.Text = icon
    i.Size = UDim2.new(0, 40, 1, 0)
    i.BackgroundTransparency = 1
    i.TextSize = 24
    i.Parent = b
    
    local txt = Instance.new("TextLabel")
    txt.Text = name
    txt.Size = UDim2.new(1, -40, 1, 0)
    txt.Position = UDim2.new(0, 40, 0, 0)
    txt.BackgroundTransparency = 1
    txt.TextColor3 = Color3.fromRGB(255, 255, 255)
    txt.Font = Enum.Font.GothamBold
    txt.TextSize = 14
    txt.TextXAlignment = Enum.TextXAlignment.Left
    txt.Parent = b

    b.MouseButton1Click:Connect(function()
        -- Check Cooldown
        if cooldowns[name] then return end
        
        -- Check Player
        if not selectedPlayer then
            txt.Text = "SELECT PLAYER!"
            txt.TextColor3 = Color3.fromRGB(255, 50, 50)
            wait(1)
            txt.Text = name
            txt.TextColor3 = Color3.fromRGB(255, 255, 255)
            return
        end
        
        -- Double Click Logic
        local t = tick()
        local last = lastClickTimes[name] or 0
        
        if t - last > 0.4 then
            -- Primo Click
            lastClickTimes[name] = t
            txt.Text = "CLICK AGAIN!"
            txt.TextColor3 = Color3.fromRGB(255, 200, 0)
            wait(0.4)
            if not cooldowns[name] then
                txt.Text = name
                txt.TextColor3 = Color3.fromRGB(255, 255, 255)
            end
            return
        end
        
        -- Secondo Click (Esecuzione)
        local char = selectedPlayer.Character
        if char and char:FindFirstChild("HumanoidRootPart") then
            func(char.HumanoidRootPart, char:FindFirstChild("Humanoid"), char)
            Notify(name, selectedPlayer.Name)
            
            -- Cooldown start
            cooldowns[name] = true
            b.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
            
            task.spawn(function()
                for k = 15, 0, -1 do
                    txt.Text = "Wait " .. k .. "s"
                    txt.TextColor3 = Color3.fromRGB(150, 150, 150)
                    wait(1)
                end
                cooldowns[name] = false
                txt.Text = name
                txt.TextColor3 = Color3.fromRGB(255, 255, 255)
                b.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
            end)
        end
    end)
end

-- 5. LISTA FUNZIONI
CreateBtn("Rocket", "üöÄ", function(root, hum, char)
    local r = Instance.new("Part", Workspace)
    r.Size = Vector3.new(2,5,2)
    r.CFrame = root.CFrame
    r.Color = Color3.fromRGB(255,0,0)
    r.Material = Enum.Material.Neon
    r.CanCollide = false
    local w = Instance.new("WeldConstraint", r); w.Part0 = root; w.Part1 = r; w.Parent = r
    
    local bv = Instance.new("BodyVelocity", root)
    bv.Velocity = Vector3.new(0, 150, 0)
    bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
    bv.Parent = root
    Debris:AddItem(r, 3)
    Debris:AddItem(bv, 3)
    delay(3, function() 
        local e = Instance.new("Explosion", Workspace); e.Position = root.Position 
    end)
end)

CreateBtn("Jail", "üëÆ", function(root, hum, char)
    local m = Instance.new("Model", Workspace)
    local center = root.Position
    root.CFrame = CFrame.new(center)
    local function p(sz, pos)
        local pt = Instance.new("Part", m)
        pt.Anchored = true
        pt.Size = sz
        pt.Color = Color3.fromRGB(20,20,20)
        pt.Material = Enum.Material.Metal
        pt.Position = center + pos
        pt.Transparency = 0
    end
    p(Vector3.new(6,1,6), Vector3.new(0,-3.5,0)) -- Floor
    p(Vector3.new(6,1,6), Vector3.new(0,3.5,0))  -- Roof
    for i=-2.5, 2.5, 1.2 do
        p(Vector3.new(0.3, 7, 0.3), Vector3.new(i, 0, 2.5))
        p(Vector3.new(0.3, 7, 0.3), Vector3.new(i, 0, -2.5))
        p(Vector3.new(0.3, 7, 0.3), Vector3.new(2.5, 0, i))
        p(Vector3.new(0.3, 7, 0.3), Vector3.new(-2.5, 0, i))
    end
    Debris:AddItem(m, 15)
end)

CreateBtn("Control", "üëÅÔ∏è", function(root, hum, char)
    camera.CameraSubject = hum
    local h = Instance.new("Hint", Workspace)
    h.Text = "CONTROLLING " .. char.Name .. " | PRESS Q TO STOP"
    local con
    con = UserInputService.InputBegan:Connect(function(io)
        if io.KeyCode == Enum.KeyCode.Q then
            camera.CameraSubject = player.Character.Humanoid
            h:Destroy()
            con:Disconnect()
        end
    end)
end)

CreateBtn("Explode", "üí•", function(root)
    local e = Instance.new("Explosion", Workspace)
    e.Position = root.Position
    e.BlastRadius = 15
end)

CreateBtn("Balloon", "üéà", function(root)
    local b = Instance.new("Part", Workspace)
    b.Shape = "Ball"
    b.Size = Vector3.new(3,3,3)
    b.Position = root.Position + Vector3.new(0,8,0)
    b.Color = Color3.fromRGB(255,0,0)
    
    local a0 = Instance.new("Attachment", b)
    local a1 = Instance.new("Attachment", root)
    local r = Instance.new("RopeConstraint", b)
    r.Attachment0 = a0; r.Attachment1 = a1; r.Length = 6; r.Visible = true
    
    local v = Instance.new("BodyVelocity", b)
    v.Velocity = Vector3.new(0,40,0)
    v.MaxForce = Vector3.new(0,4000,0)
    Debris:AddItem(b, 10)
end)

CreateBtn("Crash", "üõë", function(root)
    for i=1,30 do
        local p = Instance.new("Part", Workspace)
        p.Position = root.Position
        Debris:AddItem(p, 2)
    end
end)

CreateBtn("Radgool", "ü§∏", function(root, hum)
    hum.PlatformStand = true
    root.Velocity = Vector3.new(0,50,0)
    wait(3)
    hum.PlatformStand = false
end)

-- 6. PLAYER LIST
local function UpdateList()
    for _,v in pairs(PlayerScroll:GetChildren()) do if v:IsA("TextButton") then v:Destroy() end end
    for _,p in pairs(Players:GetPlayers()) do
        local btn = Instance.new("TextButton")
        btn.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
        btn.Size = UDim2.new(1,0,0,45)
        btn.Text = ""
        btn.Parent = PlayerScroll
        local c = Instance.new("UICorner"); c.CornerRadius = UDim.new(0,8); c.Parent = btn
        
        local img = Instance.new("ImageLabel")
        img.Size = UDim2.new(0,35,0,35)
        img.Position = UDim2.new(0,5,0.5,-17.5)
        img.BackgroundTransparency = 1
        spawn(function() img.Image = Players:GetUserThumbnailAsync(p.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48) end)
        img.Parent = btn
        local ic = Instance.new("UICorner"); ic.CornerRadius = UDim.new(1,0); ic.Parent = img
        
        local t = Instance.new("TextLabel")
        t.Text = p.Name
        t.Size = UDim2.new(1,-50,1,0)
        t.Position = UDim2.new(0,50,0,0)
        t.BackgroundTransparency = 1
        t.TextColor3 = Color3.fromRGB(255,255,255)
        t.TextXAlignment = Enum.TextXAlignment.Left
        t.Font = Enum.Font.GothamSemibold
        t.TextSize = 14
        t.Parent = btn
        
        btn.MouseButton1Click:Connect(function()
            selectedPlayer = p
            for _,x in pairs(PlayerScroll:GetChildren()) do if x:IsA("TextButton") then x.BackgroundColor3 = Color3.fromRGB(40,40,40) end end
            btn.BackgroundColor3 = Color3.fromRGB(0, 150, 80)
        end)
    end
end

Players.PlayerAdded:Connect(UpdateList)
Players.PlayerRemoving:Connect(UpdateList)
UpdateList()

-- 7. APERTURA
ToggleBtn.MouseButton1Click:Connect(function()
    PanelOpen = not PanelOpen
    MainFrame.Visible = PanelOpen
end)

CloseBtn.MouseButton1Click:Connect(function()
    PanelOpen = false
    MainFrame.Visible = false
end)

print("‚úÖ ADMIN PANEL LOADED - 100% WORKING MODE")
