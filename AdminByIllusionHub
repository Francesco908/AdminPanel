--[[
    üí≤ ULTIMATE ADMIN PANEL - REPLICA EXACT IMAGE
    Client-Side Executor Script
    Author: Illusion Hub Replica
]]

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")

local player = Players.LocalPlayer
local Mouse = player:GetMouse()

-- Cleanup vecchio
for _, gui in pairs(CoreGui:GetChildren()) do
    if gui.Name == "IllusionAdminPanel" then gui:Destroy() end
end

-- Variabili Globali
local selectedPlayer = nil
local cooldowns = {}

-- 1. GUI CREATION
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "IllusionAdminPanel"
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.Parent = CoreGui -- Usa CoreGui per stare sopra tutto (se l'executor lo permette)

-- Toggle Button (üí≤)
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Name = "Toggle"
ToggleBtn.Size = UDim2.new(0, 40, 0, 40)
ToggleBtn.Position = UDim2.new(1, -160, 0, 5) -- Posizionato vicino ai controlli Roblox
ToggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
ToggleBtn.BorderSizePixel = 0
ToggleBtn.Text = "üí≤"
ToggleBtn.TextSize = 25
ToggleBtn.TextColor3 = Color3.fromRGB(0, 255, 100)
ToggleBtn.Font = Enum.Font.GothamBold
ToggleBtn.Parent = ScreenGui

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 8)
ToggleCorner.Parent = ToggleBtn

-- Main Frame (Il pannello scuro)
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 550, 0, 350)
MainFrame.Position = UDim2.new(0.5, -275, 0.5, -175)
MainFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
MainFrame.BorderSizePixel = 0
MainFrame.Visible = false
MainFrame.Active = true
MainFrame.Draggable = true -- Movibile
MainFrame.Parent = ScreenGui

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 5)
MainCorner.Parent = MainFrame

-- Header (Titolo)
local Header = Instance.new("Frame")
Header.Size = UDim2.new(1, 0, 0, 40)
Header.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
Header.BorderSizePixel = 0
Header.Parent = MainFrame

local HeaderCorner = Instance.new("UICorner")
HeaderCorner.CornerRadius = UDim.new(0, 5)
HeaderCorner.Parent = Header

-- Fix angoli inferiori header
local HeaderFix = Instance.new("Frame")
HeaderFix.Size = UDim2.new(1, 0, 0, 10)
HeaderFix.Position = UDim2.new(0, 0, 1, -10)
HeaderFix.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
HeaderFix.BorderSizePixel = 0
HeaderFix.Parent = Header

local Title = Instance.new("TextLabel")
Title.Text = "ADMIN PANEL"
Title.Size = UDim2.new(1, -50, 1, 0)
Title.Position = UDim2.new(0, 15, 0, 0)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 20
Title.Font = Enum.Font.GothamBlack
Title.TextXAlignment = Enum.TextXAlignment.Left
Title.Parent = Header

-- Close Button (X Rossa)
local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 40, 0, 40)
CloseBtn.Position = UDim2.new(1, -40, 0, 0)
CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseBtn.BorderSizePixel = 0
CloseBtn.Text = "X"
CloseBtn.TextSize = 18
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.Font = Enum.Font.GothamBold
CloseBtn.Parent = Header

local CloseCorner = Instance.new("UICorner")
CloseCorner.CornerRadius = UDim.new(0, 5)
CloseCorner.Parent = CloseBtn

-- Search Bar (Come nella foto: "Type Command")
local SearchBar = Instance.new("TextBox")
SearchBar.Size = UDim2.new(0.6, 0, 0, 30)
SearchBar.Position = UDim2.new(0, 10, 0, 50)
SearchBar.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
SearchBar.BorderSizePixel = 0
SearchBar.Text = ""
SearchBar.PlaceholderText = "Type Command..."
SearchBar.TextColor3 = Color3.fromRGB(255, 255, 255)
SearchBar.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
SearchBar.TextSize = 14
SearchBar.Font = Enum.Font.Gotham
SearchBar.TextXAlignment = Enum.TextXAlignment.Left
SearchBar.Parent = MainFrame

local SearchPad = Instance.new("UIPadding")
SearchPad.PaddingLeft = UDim.new(0, 10)
SearchPad.Parent = SearchBar

local SearchCorner = Instance.new("UICorner")
SearchCorner.CornerRadius = UDim.new(0, 5)
SearchCorner.Parent = SearchBar

-- Container Sinistra (Griglia Comandi)
local CommandContainer = Instance.new("ScrollingFrame")
CommandContainer.Size = UDim2.new(0.6, 0, 1, -90)
CommandContainer.Position = UDim2.new(0, 10, 0, 85)
CommandContainer.BackgroundTransparency = 1
CommandContainer.BorderSizePixel = 0
CommandContainer.ScrollBarThickness = 2
CommandContainer.Parent = MainFrame

local Grid = Instance.new("UIGridLayout")
Grid.CellSize = UDim2.new(0.48, 0, 0, 40)
Grid.CellPadding = UDim2.new(0.04, 0, 0, 10)
Grid.SortOrder = Enum.SortOrder.LayoutOrder
Grid.Parent = CommandContainer

-- Container Destra (Player List)
local PlayerContainer = Instance.new("ScrollingFrame")
PlayerContainer.Size = UDim2.new(0.35, 0, 1, -50)
PlayerContainer.Position = UDim2.new(0.63, 0, 0, 50) -- Allineato a destra
PlayerContainer.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
PlayerContainer.BorderSizePixel = 0
PlayerContainer.ScrollBarThickness = 2
PlayerContainer.Parent = MainFrame

local PlayerListLayout = Instance.new("UIListLayout")
PlayerListLayout.Padding = UDim.new(0, 5)
PlayerListLayout.SortOrder = Enum.SortOrder.LayoutOrder
PlayerListLayout.Parent = PlayerContainer

-- 2. FUNZIONI UTILI

-- Funzione per creare bottoni comandi (Stile Foto)
local function CreateCommandBtn(name, displayNames, icon)
    local btn = Instance.new("TextButton")
    btn.Name = name
    btn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    btn.BorderSizePixel = 0
    btn.Text = ""
    btn.AutoButtonColor = false
    btn.Parent = CommandContainer

    local btnCorner = Instance.new("UICorner")
    btnCorner.CornerRadius = UDim.new(0, 5)
    btnCorner.Parent = btn
    
    local btnStroke = Instance.new("UIStroke")
    btnStroke.Color = Color3.fromRGB(60, 60, 60)
    btnStroke.Thickness = 1
    btnStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    btnStroke.Parent = btn

    -- Icona
    local ico = Instance.new("TextLabel")
    ico.Text = icon
    ico.Size = UDim2.new(0, 30, 1, 0)
    ico.BackgroundTransparency = 1
    ico.TextSize = 20
    ico.TextColor3 = Color3.fromRGB(255, 255, 255)
    ico.Parent = btn

    -- Testo (;command)
    local txt = Instance.new("TextLabel")
    txt.Text = ";" .. string.lower(displayNames)
    txt.Size = UDim2.new(1, -35, 1, 0)
    txt.Position = UDim2.new(0, 35, 0, 0)
    txt.BackgroundTransparency = 1
    txt.TextSize = 14
    txt.TextColor3 = Color3.fromRGB(255, 255, 255)
    txt.Font = Enum.Font.GothamBold
    txt.TextXAlignment = Enum.TextXAlignment.Left
    txt.Parent = btn

    -- Effetto Click
    btn.MouseButton1Click:Connect(function()
        -- Reset colori
        for _, c in pairs(CommandContainer:GetChildren()) do
            if c:IsA("TextButton") then
                c.UIStroke.Color = Color3.fromRGB(60, 60, 60)
                c.UIStroke.Thickness = 1
            end
        end
        -- Evidenzia questo (Giallo/Oro come foto)
        btnStroke.Color = Color3.fromRGB(255, 215, 0) 
        btnStroke.Thickness = 2
        
        -- Esegui comando
        if _G.ExecuteCommand then
            _G.ExecuteCommand(name)
        end
    end)
end

-- Funzione per creare Player nella lista (con Avatar)
local function CreatePlayerEntry(plr)
    local entry = Instance.new("TextButton")
    entry.Name = plr.Name
    entry.Size = UDim2.new(1, 0, 0, 40)
    entry.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    entry.BackgroundTransparency = 0.5
    entry.BorderSizePixel = 0
    entry.Text = ""
    entry.Parent = PlayerContainer

    -- Avatar Image
    local avatar = Instance.new("ImageLabel")
    avatar.Size = UDim2.new(0, 30, 0, 30)
    avatar.Position = UDim2.new(0, 5, 0.5, -15)
    avatar.BackgroundTransparency = 1
    -- Ottieni immagine testa
    local content, isReady = Players:GetUserThumbnailAsync(plr.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48)
    avatar.Image = content
    avatar.Parent = entry
    
    local avCorner = Instance.new("UICorner")
    avCorner.CornerRadius = UDim.new(1, 0) -- Rotondo
    avCorner.Parent = avatar

    -- Nome
    local nameLbl = Instance.new("TextLabel")
    nameLbl.Text = plr.Name
    nameLbl.Size = UDim2.new(1, -45, 1, 0)
    nameLbl.Position = UDim2.new(0, 45, 0, 0)
    nameLbl.BackgroundTransparency = 1
    nameLbl.TextColor3 = Color3.fromRGB(200, 200, 200)
    nameLbl.TextSize = 12
    nameLbl.Font = Enum.Font.GothamSemibold
    nameLbl.TextXAlignment = Enum.TextXAlignment.Left
    nameLbl.Parent = entry

    -- Selezione
    entry.MouseButton1Click:Connect(function()
        selectedPlayer = plr
        for _, c in pairs(PlayerContainer:GetChildren()) do
            if c:IsA("TextButton") then
                c.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
                c.NameLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
            end
        end
        entry.BackgroundColor3 = Color3.fromRGB(0, 150, 80) -- Verde selezione
        nameLbl.TextColor3 = Color3.fromRGB(255, 255, 255)
    end)
    
    entry.NameLabel = nameLbl -- Reference rapida
end

-- Aggiorna Lista Player
local function RefreshPlayers()
    for _, c in pairs(PlayerContainer:GetChildren()) do
        if c:IsA("TextButton") then c:Destroy() end
    end
    for _, p in pairs(Players:GetPlayers()) do
        CreatePlayerEntry(p)
    end
end

Players.PlayerAdded:Connect(RefreshPlayers)
Players.PlayerRemoving:Connect(RefreshPlayers)
RefreshPlayers()

-- 3. LOGICA COMANDI (Client Side Physics)

_G.ExecuteCommand = function(cmd)
    if not selectedPlayer then return end
    local char = selectedPlayer.Character
    if not char then return end
    local root = char:FindFirstChild("HumanoidRootPart")
    local hum = char:FindFirstChild("Humanoid")
    
    if not root or not hum then return end

    if cmd == "Rocket" then
        -- Razzo Visuale + Velocity
        local rocket = Instance.new("Part")
        rocket.Size = Vector3.new(1, 4, 1)
        rocket.Position = root.Position
        rocket.BrickColor = BrickColor.new("Bright red")
        rocket.Material = Enum.Material.Neon
        rocket.CanCollide = false
        rocket.Parent = workspace
        
        local w = Instance.new("WeldConstraint", rocket)
        w.Part0 = root
        w.Part1 = rocket
        
        local bv = Instance.new("BodyVelocity", root)
        bv.Velocity = Vector3.new(0, 100, 0)
        bv.MaxForce = Vector3.new(0, math.huge, 0)
        
        game:GetService("Debris"):AddItem(rocket, 3)
        game:GetService("Debris"):AddItem(bv, 3)
        
    elseif cmd == "Ragdoll" then
        -- "Inverse" controls logic requested
        if selectedPlayer == player then
           -- Local inversion logic (only works on self easily)
           hum.WalkSpeed = -16 
           wait(10)
           hum.WalkSpeed = 16
        end
        
    elseif cmd == "Jail" then
        -- Visual Jail
        local jailModel = Instance.new("Model", workspace)
        local function part(pos, sz)
            local p = Instance.new("Part", jailModel)
            p.Anchored = true
            p.Size = sz
            p.Position = root.Position + pos
            p.Transparency = 0.5
            p.Color = Color3.new(0,0,0)
        end
        part(Vector3.new(0,0,3), Vector3.new(6,6,0.5))
        part(Vector3.new(0,0,-3), Vector3.new(6,6,0.5))
        part(Vector3.new(3,0,0), Vector3.new(0.5,6,6))
        part(Vector3.new(-3,0,0), Vector3.new(0.5,6,6))
        game:GetService("Debris"):AddItem(jailModel, 10)

    elseif cmd == "Balloon" then
        -- Balloon Visual
        local b = Instance.new("Part", workspace)
        b.Shape = Enum.PartType.Ball
        b.Size = Vector3.new(3,3,3)
        b.Position = root.Position + Vector3.new(0,6,0)
        b.Color = Color3.fromRGB(255,0,0)
        b.Anchored = false
        
        local att1 = Instance.new("Attachment", b)
        local att2 = Instance.new("Attachment", root)
        local rope = Instance.new("RopeConstraint", b)
        rope.Attachment0 = att1
        rope.Attachment1 = att2
        rope.Length = 5
        rope.Visible = true
        
        local bv = Instance.new("BodyVelocity", b)
        bv.Velocity = Vector3.new(0,20,0)
        bv.MaxForce = Vector3.new(0,2000,0)
        game:GetService("Debris"):AddItem(b, 10)

    elseif cmd == "Control" then
        workspace.CurrentCamera.CameraSubject = hum
        
    elseif cmd == "Nightvision" then
        local light = Instance.new("PointLight", root)
        light.Range = 60
        light.Brightness = 2
        
    elseif cmd == "Tiny" then
         -- Client side resizing (only works well if you are server, but tries visual)
         if hum then
             hum.HipHeight = 0.5
         end
    end
end

-- 4. CREAZIONE BOTTONI (Ordine della foto)
CreateCommandBtn("Rocket", "Rocket", "üöÄ")
CreateCommandBtn("Ragdoll", "Ragdoll", "ü§∏")
CreateCommandBtn("Balloon", "Balloon", "üéà")
CreateCommandBtn("Ragdoll", "Inverse", "üîÉ") -- Reuse logic
CreateCommandBtn("Nightvision", "Nightvision", "üëÅÔ∏è")
CreateCommandBtn("Jail", "Jail", "üëÆ")
CreateCommandBtn("Control", "Control", "üé≠")
CreateCommandBtn("Tiny", "Tiny", "üêú")


-- 5. APRI/CHIUDI
local isOpen = false
ToggleBtn.MouseButton1Click:Connect(function()
    isOpen = not isOpen
    MainFrame.Visible = isOpen
end)

CloseBtn.MouseButton1Click:Connect(function()
    isOpen = false
    MainFrame.Visible = false
end)
